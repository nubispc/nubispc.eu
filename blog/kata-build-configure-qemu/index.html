<!doctype html><!-- This site was created with Hugo Blox. https://hugoblox.com --><!-- Last Published: February 20, 2026 --><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo Blox Builder 5.9.7"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=/css/vendor-bundle.min.26c458e6907dc03073573976b7f4044e.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=/css/wowchemy.1aac88f67649a5938f00c9b82441a209.css><link rel=stylesheet href=/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=author content="Charalampos Mainas"><meta name=description content="Picking up from where we left in our previous
post, we will now
install QEMU and configure Kata Containers to use QEMU as their hypervisor."><link rel=alternate hreflang=en-us href=/blog/kata-build-configure-qemu/><link rel=canonical href=/blog/kata-build-configure-qemu/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu_997e0522978c46c6.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu_409bdbda4e241619.png><meta name=theme-color content="#1565c0"><meta property="twitter:card" content="summary"><meta property="twitter:site" content="@GetResearchDev"><meta property="twitter:creator" content="@GetResearchDev"><meta property="twitter:image" content="/media/logo_hu_866fdf07312224c.png"><meta property="og:type" content="website"><meta property="og:site_name" content="Nubificus"><meta property="og:url" content="/blog/kata-build-configure-qemu/"><meta property="og:title" content="Kata Containers: Build and configure QEMU | Nubificus"><meta property="og:description" content="Picking up from where we left in our previous
post, we will now
install QEMU and configure Kata Containers to use QEMU as their hypervisor."><meta property="og:image" content="/media/logo_hu_866fdf07312224c.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2022-03-28T10:18:06+00:00"><meta property="article:modified_time" content="2022-03-28T10:18:06+00:00"><script src=https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.js integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.css integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin=anonymous><script>window.addEventListener("load",function(){window.cookieconsent.initialise({palette:{popup:{background:"#1565c0",text:"rgb(255, 255, 255)"},button:{background:"rgb(255, 255, 255)",text:"#1565c0"}},theme:"classic",content:{message:"This website uses cookies to ensure you get the best experience on our website.",dismiss:"Got it!",link:"Learn more",href:"https://www.cookiesandyou.com"}})})</script><title>Kata Containers: Build and configure QEMU | Nubificus</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=eb3c388dd53e6daa74a2a2fae3f23a4f><script src=/js/wowchemy-init.min.9e4214442a7711d35691acd58f6f6361.js></script><div class="page-header header--fixed"><style>.navbar-logo img{max-height:45px;width:auto;display:block}.navbar-logo .logo-dark{display:none}body.colorscheme-dark .navbar-logo .logo-light,body.dark .navbar-logo .logo-light{display:none}body.colorscheme-dark .navbar-logo .logo-dark,body.dark .navbar-logo .logo-dark{display:block}.navbar-logo.logo-nubis,.navbar-logo.logo-nubificus{display:none}</style><script>document.addEventListener("DOMContentLoaded",function(){var e=window.location.hostname,t=e==="nubis-pc.eu"||e==="www.nubis-pc.eu",n=t?"logo-nubis":"logo-nubificus";document.querySelectorAll(".navbar-logo."+n).forEach(function(e){e.style.display="flex"}),document.querySelectorAll("[data-brand]").forEach(function(e){var n=e.getAttribute("data-brand");t?e.textContent=n==="primary"?"Nubis":"Nubificus":e.textContent=n==="primary"?"Nubificus":"Nubis"})})</script><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/><div class="navbar-logo logo-nubificus"><img class=logo-light src=/media/logo-nubificus_hu_7be4fa6b19286a64.png alt=Nubificus>
<img class=logo-dark src=/media/logo-nubificus-dark_hu_bd80a6d6121ee2ff.png alt=Nubificus></div><div class="navbar-logo logo-nubis"><img class=logo-light src=/media/logo-nubis.png alt="Nubis PC">
<img class=logo-dark src=/media/logo-nubis-dark.png alt="Nubis PC"></div></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/><div class="navbar-logo logo-nubificus"><img class=logo-light src=/media/logo-nubificus_hu_7be4fa6b19286a64.png alt=Nubificus>
<img class=logo-dark src=/media/logo-nubificus-dark_hu_bd80a6d6121ee2ff.png alt=Nubificus></div><div class="navbar-logo logo-nubis"><img class=logo-light src=/media/logo-nubis.png alt="Nubis PC">
<img class=logo-dark src=/media/logo-nubis-dark.png alt="Nubis PC"></div></a></div><div class="navbar-collapse main-menu-item collapse justify-content-end" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/><span>Home</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Research</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/projects/><span>Projects</span></a>
<a class=dropdown-item href=/publication><span>Publications</span></a></div></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Solutions</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/solutions/edgelink/><span>edgeLink</span></a>
<a class=dropdown-item href=/solutions/urunc/><span>urunc</span></a>
<a class=dropdown-item href=/solutions/vaccel/><span>vAccel</span></a></div></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Feed</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/post><span>News</span></a>
<a class=dropdown-item href=/event><span>Events</span></a></div></li><li class=nav-item><a class="nav-link active" href=/blog><span>Blog</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>About</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/people><span>People</span></a>
<a class=dropdown-item href=/contact><span>Contact</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span>
</a><a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span>
</a><a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".navbar-nav .nav-item.dropdown");e.forEach(function(t){t.addEventListener("mouseenter",function(){e.forEach(function(e){if(e!==t){e.classList.remove("show");var n=e.querySelector(".dropdown-menu");n&&n.classList.remove("show")}}),t.classList.add("show");var n=t.querySelector(".dropdown-menu");n&&n.classList.add("show")}),t.addEventListener("mouseleave",function(){t.classList.remove("show");var e=t.querySelector(".dropdown-menu");e&&e.classList.remove("show")})})})</script></div><div class=page-body><article class=article><div class=article-container><a class=blog-back-link href=javascript:void(0) onclick=blogGoBack()><i class="fas fa-arrow-left"></i> Back to Blog</a></div><div class="article-container pt-3"><h1>Kata Containers: Build and configure QEMU</h1><div class=article-metadata><span class=article-date>Mar 28, 2022</span></div></div><div class=article-container><div class=article-style><p>Picking up from where we left in our <a href=/posts/kata-build-source>previous
post</a>, we will now
install QEMU and configure Kata Containers to use QEMU as their hypervisor.</p><h3 id=build-qemu>Build QEMU</h3><p>First, we need to build <code>qemu-system</code> for the CPU architecture of our host machine. Kata Containers provide scripts to manage the build of QEMU both for
x86 and arm64 hosts. We will be using them to make sure that our QEMU installation is suitable for usage with Kata Containers.</p><h4 id=build-qemu-for-x86>Build QEMU for x86</h4><p>We need to get the correct version of QEMU from the versions file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GOPATH</span><span class=o>=</span><span class=k>$(</span>go env GOPATH<span class=k>)</span> <span class=o>&amp;&amp;</span> <span class=nb>export</span> <span class=nv>GO111MODULE</span><span class=o>=</span>off
</span></span><span class=line><span class=cl><span class=nb>source</span> <span class=si>${</span><span class=nv>GOPATH</span><span class=si>}</span>/src/github.com/kata-containers/kata-containers/tools/packaging/scripts/lib.sh
</span></span><span class=line><span class=cl><span class=nv>qemu_version</span><span class=o>=</span><span class=k>$(</span>get_from_kata_deps <span class=s2>&#34;assets.hypervisor.qemu.version&#34;</span><span class=k>)</span>
</span></span></code></pre></div><p>Next, we need to get the QEMU source from the matching branch:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go get -d github.com/qemu/qemu
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=si>${</span><span class=nv>GOPATH</span><span class=si>}</span>/src/github.com/qemu/qemu
</span></span><span class=line><span class=cl>git checkout <span class=si>${</span><span class=nv>qemu_version</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=nv>your_qemu_directory</span><span class=o>=</span><span class=si>${</span><span class=nv>GOPATH</span><span class=si>}</span>/src/github.com/qemu/qemu
</span></span></code></pre></div><p>We need to see which version of QEMU we will be building.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=si>${</span><span class=nv>qemu_version</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=c1># v6.2.0</span>
</span></span></code></pre></div><p>Now we will use the scripts provided to apply the necessary patches to QEMU. Make sure to change the commands below to match the version of QEMU that you are targeting.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>packaging_dir</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>GOPATH</span><span class=si>}</span><span class=s2>/src/github.com/kata-containers/kata-containers/tools/packaging&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$packaging_dir</span>/scripts/apply_patches.sh <span class=nv>$packaging_dir</span>/qemu/patches/6.2.x/
</span></span></code></pre></div><p>Once the patches are successfully applied, we need to install some apt packages that are required to build <code>qemu-system</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install ninja-build pkg-config <span class=se>\
</span></span></span><span class=line><span class=cl>  libglib2.0-dev <span class=se>\
</span></span></span><span class=line><span class=cl>  libpixman-1-dev <span class=se>\
</span></span></span><span class=line><span class=cl>  libseccomp-dev <span class=se>\
</span></span></span><span class=line><span class=cl>  libcap-ng-dev <span class=se>\
</span></span></span><span class=line><span class=cl>  librados-dev <span class=se>\
</span></span></span><span class=line><span class=cl>  libpmem-dev <span class=se>\
</span></span></span><span class=line><span class=cl>  librbd-dev <span class=se>\
</span></span></span><span class=line><span class=cl>  libgcrypt-dev
</span></span></code></pre></div><p>Now, we can finally build QEMU:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> <span class=nv>$your_qemu_directory</span>
</span></span><span class=line><span class=cl><span class=nv>$packaging_dir</span>/scripts/configure-hypervisor.sh kata-qemu &gt; kata.cfg
</span></span><span class=line><span class=cl><span class=nb>eval</span> ./configure <span class=s2>&#34;</span><span class=k>$(</span>cat kata.cfg<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>make -j <span class=k>$(</span>nproc<span class=k>)</span>
</span></span><span class=line><span class=cl>sudo -E make install
</span></span></code></pre></div><p>If you followed the instructions in our previous post and you have set the <code>PREFIX</code> variable to <code>/opt/kata</code> the <code>qemu-system-x86_64</code> binary will be stored under the <code>/opt/kata/bin/</code> directory, <code>tools/virtiofsd/virtiofsd</code> under the <code>/opt/kata/libexec/kata-qemu</code> directory and all the other files will be stored under the <code>/opt/kata/share/kata-qemu</code> directory.</p><p>We can also install <code>virtiofsd</code> and <code>qemu-system-x86_64</code> under the default location using the <code>install_qemu.sh</code> script.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go get -d github.com/kata-containers/tests
</span></span><span class=line><span class=cl>script -fec <span class=s1>&#39;sudo -E ${GOPATH}/src/github.com/kata-containers/tests/.ci/install_qemu.sh&#39;</span>
</span></span></code></pre></div><h4 id=build-qemu-for-aarch64>Build QEMU for aarch64</h4><p>Install requirements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install -y build-essential pkg-config <span class=se>\
</span></span></span><span class=line><span class=cl>  libglib2.0-dev libpixman-1-dev <span class=se>\
</span></span></span><span class=line><span class=cl>  libaio-dev libseccomp-dev <span class=se>\
</span></span></span><span class=line><span class=cl>  libcap-ng-dev librados-dev <span class=se>\
</span></span></span><span class=line><span class=cl>  librbd-dev libzstd-dev
</span></span></code></pre></div><p>Set required environment variables</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:<span class=k>$(</span>go env GOPATH<span class=k>)</span>/bin <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  <span class=nb>export</span> <span class=nv>GOPATH</span><span class=o>=</span><span class=k>$(</span>go env GOPATH<span class=k>)</span> <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  <span class=nb>export</span> <span class=nv>GO111MODULE</span><span class=o>=</span>off
</span></span></code></pre></div><p>Build QEMU using the <code>install_qemu.sh</code> script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo rm -rf <span class=si>${</span><span class=nv>GOPATH</span><span class=si>}</span>/src/github.com/qemu/qemu <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  go get -d github.com/kata-containers/tests <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  script -fec <span class=s1>&#39;sudo -E ${GOPATH}/src/github.com/kata-containers/tests/.ci/install_qemu.sh&#39;</span>
</span></span></code></pre></div><h3 id=configure-kata-containers>Configure Kata Containers</h3><p>Next, we need to install the Kata Containers configuration file. We will use this file to configure Kata Containers to use the initrd image we built in our previous post. You could also use a rootfs image, if you prefer.
We will also enable guest <code>seccomp</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mkdir -p /opt/kata/configs
</span></span><span class=line><span class=cl>sudo install -o root -g root -m <span class=m>0640</span> /opt/kata/share/defaults/kata-containers/configuration.toml /opt/kata/configs
</span></span><span class=line><span class=cl><span class=c1># comment out the image entry</span>
</span></span><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;s/^\(image =.*\)/# \1/g&#39;</span> /opt/kata/configs/configuration.toml
</span></span><span class=line><span class=cl><span class=c1># enable seccomp</span>
</span></span><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;/^disable_guest_seccomp/ s/true/false/&#39;</span> /opt/kata/configs/configuration.toml
</span></span></code></pre></div><p>Make sure that <code>/opt/kata/configs/configuration.toml</code> has a initrd entry pointing to the initrd we created:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=m>17</span>   <span class=p>|</span> <span class=c1>#image = &#34;/opt/kata/share/kata-containers/kata-containers-image.img&#34;</span>
</span></span><span class=line><span class=cl><span class=m>18</span>   │ <span class=nv>initrd</span> <span class=o>=</span> <span class=s2>&#34;/opt/kata/share/kata-containers/kata-containers-initrd.img&#34;</span>
</span></span></code></pre></div><h3 id=configure-containerd>Configure containerd</h3><p>You need to edit the containerd config file (usually <code>/etc/containerd/config.toml</code>.</p><p>First we need to remove <code>cri</code> from the disabled plugins list:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#disabled_plugins = [&#34;cri&#34;]
</span></span><span class=line><span class=cl>disabled_plugins = []
</span></span></code></pre></div><p>We also need to add the relevant handler for the kata runtime:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[plugins]
</span></span><span class=line><span class=cl>  [plugins.cri]
</span></span><span class=line><span class=cl>    [plugins.cri.containerd]
</span></span><span class=line><span class=cl>      [plugins.cri.containerd.runtimes]
</span></span><span class=line><span class=cl>        [plugins.cri.containerd.runtimes.kata]
</span></span><span class=line><span class=cl>         runtime_type = &#34;io.containerd.kata.v2&#34;
</span></span><span class=line><span class=cl>         privileged_without_host_devices = true
</span></span><span class=line><span class=cl>         [plugins.cri.containerd.runtimes.kata.options]
</span></span><span class=line><span class=cl>           ConfigPath = &#34;/opt/kata/configs/configuration.toml&#34;
</span></span></code></pre></div><p>Once the changes are saved, restart containerd: <code>sudo systemctl restart containerd</code>.</p><p>To verify our installation is successful, we can launch an Ubuntu test container:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ctr images pull docker.io/library/ubuntu:latest
</span></span><span class=line><span class=cl>sudo ctr run --runtime io.containerd.run.kata.v2 -t --rm docker.io/library/ubuntu:latest ubuntu-kata-test uname -a
</span></span><span class=line><span class=cl><span class=c1># Linux e678ab3c6fc3 5.15.26 #2 SMP Sat Mar 19 21:02:56 UTC 2022 aarch64 aarch64 aarch64 GNU/Linux</span>
</span></span></code></pre></div><p><strong>Note 1 for aarch64</strong>:</p><p>We noticed that, in some instances, trying to launch a container produced the following error:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># sudo ctr images pull docker.io/library/busybox:latest</span>
</span></span><span class=line><span class=cl><span class=c1># ctr run --runtime io.containerd.run.kata.v2 -t --rm docker.io/library/busybox:latest hello1 sh</span>
</span></span><span class=line><span class=cl>ctr: failed to create shim: failed to launch qemu: <span class=nb>exit</span> status 1, error messages from qemu log: qemu-system-aarch64: warning: For GICv2 max-cpus must be equal to smp-cpus
</span></span><span class=line><span class=cl>qemu-system-aarch64: warning: Overriding specified max-cpus<span class=o>(</span>4<span class=o>)</span> with smp-cpus<span class=o>(</span>1<span class=o>)</span>
</span></span><span class=line><span class=cl>qemu-system-aarch64: warning: global kvm-pit.lost_tick_policy has invalid class name
</span></span><span class=line><span class=cl>Restoring <span class=m>1</span> CPU interfaces, kernel only has <span class=m>4</span>
</span></span><span class=line><span class=cl>: unknown
</span></span></code></pre></div><p>A workaround for that problem was to set the <code>default_vcpus = 8</code> in <code>/opt/kata/configs/configuration.toml</code>.</p><p><strong>Note 2 for aarch64</strong>:</p><p>We tried running on an older kernel, on an NVIDIA Jetson AGX Xavier and on an
NVIDIA Jetson Nano, versions 4.9.253-tegra-virt (getting KVM to work on these
boards is also quite a challenge, more details on a subsequent post). Apart
from the GIC issue above, we saw that virtio-fs is not backported, nor is there
support for the nvdimm stuff, so the following changes to the config file are
needed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-patch data-lang=patch><span class=line><span class=cl><span class=gd>--- configuration-qemu-stock.toml   2022-03-24 20:55:47.010284096 +0000
</span></span></span><span class=line><span class=cl><span class=gi>+++ configuration-qemu.toml    2022-03-24 21:34:39.725554126 +0000
</span></span></span><span class=line><span class=cl><span class=gu>@@ -103,7 +103,7 @@
</span></span></span><span class=line><span class=cl> # vCPUs supported by the SB/VM. In general, we recommend that you do not edit this variable,
</span></span><span class=line><span class=cl> # unless you know what are you doing.
</span></span><span class=line><span class=cl> # NOTICE: on arm platform with gicv2 interrupt controller, set it to 8.
</span></span><span class=line><span class=cl><span class=gd>-default_maxvcpus = 0
</span></span></span><span class=line><span class=cl><span class=gi>+default_maxvcpus = 1
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> # Bridges can be used to hot plug devices.
</span></span><span class=line><span class=cl> # Limitations:
</span></span><span class=line><span class=cl><span class=gu>@@ -151,7 +151,7 @@
</span></span></span><span class=line><span class=cl> #   - virtio-fs (default)
</span></span><span class=line><span class=cl> #   - virtio-9p
</span></span><span class=line><span class=cl> #   - virtio-fs-nydus
</span></span><span class=line><span class=cl><span class=gd>-shared_fs = &#34;virtio-fs&#34;
</span></span></span><span class=line><span class=cl><span class=gi>+shared_fs = &#34;virtio-9p&#34;
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> # Path to vhost-user-fs daemon.
</span></span><span class=line><span class=cl> virtio_fs_daemon = &#34;/opt/kata/libexec/kata-qemu/virtiofsd&#34;
</span></span><span class=line><span class=cl><span class=gu>@@ -292,7 +292,7 @@
</span></span></span><span class=line><span class=cl> # nvdimm is not supported when `confidential_guest = true`.
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> # Default is false
</span></span><span class=line><span class=cl><span class=gd>-#disable_image_nvdimm = true
</span></span></span><span class=line><span class=cl><span class=gi>+disable_image_nvdimm = true
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> # VFIO devices are hotplugged on a bridge by default.
</span></span><span class=line><span class=cl> # Enable hotplugging on root bus. This may be required for devices with
</span></span></code></pre></div><p>Interestingly enough, <code>default_vcpus</code> must be equal to <code>default_maxvcpus</code> on
such platforms.</p></div><div class=article-tags><a class="badge badge-light" href=/tag/kata-containers/>Kata-Containers</a>
<a class="badge badge-light" href=/tag/containers/>Containers</a>
<a class="badge badge-light" href=/tag/qemu/>QEMU</a>
<a class="badge badge-light" href=/tag/aarch64/>Aarch64</a>
<a class="badge badge-light" href=/tag/hypervisor/>Hypervisor</a></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=%2Fblog%2Fkata-build-configure-qemu%2F&amp;text=Kata+Containers%3A+Build+and+configure+QEMU" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=%2Fblog%2Fkata-build-configure-qemu%2F&amp;t=Kata+Containers%3A+Build+and+configure+QEMU" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Kata%20Containers%3A%20Build%20and%20configure%20QEMU&amp;body=%2Fblog%2Fkata-build-configure-qemu%2F" target=_blank rel=noopener class=share-btn-email aria-label=envelope><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=%2Fblog%2Fkata-build-configure-qemu%2F&amp;title=Kata+Containers%3A+Build+and+configure+QEMU" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Kata+Containers%3A+Build+and+configure+QEMU%20%2Fblog%2Fkata-build-configure-qemu%2F" target=_blank rel=noopener class=share-btn-whatsapp aria-label=whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=%2Fblog%2Fkata-build-configure-qemu%2F&amp;title=Kata+Containers%3A+Build+and+configure+QEMU" target=_blank rel=noopener class=share-btn-weibo aria-label=weibo><i class="fab fa-weibo"></i></a></li></ul></div></div></article><script>function blogGoBack(){document.referrer&&document.referrer.indexOf("/blog")!==-1?history.back():window.location.href="/blog/"}</script></div><div class=page-footer><div class=container><footer class=site-footer><p class="powered-by copyright-license-text">© 2026 Nubificus LTD. This work is licensed under <a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank>CC BY NC ND 4.0</a></p><p class="powered-by footer-license-icons"><a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank aria-label="Creative Commons"><i class="fab fa-creative-commons fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-by fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nc fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nd fa-2x" aria-hidden=true></i></a></p><p class=powered-by>Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target=_blank rel=noopener>Hugo Blox Builder</a> — the free, <a href=https://github.com/HugoBlox/hugo-blox-builder target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><script src=/js/vendor-bundle.min.6782e3f6a4f06ea4766df038c45ecf40.js></script><script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script><script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.b95a7e109243f29d04930ae8cb49a756.js type=module></script><script src=/en/js/wowchemy.min.ed487406ecbb80985462ba7a97b6f2d2.js></script><script src=/js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js type=module></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy
</a><a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=/js/wowchemy-publication.9c0e895144aef5a693008b5c5d450147.js type=module></script></body></html>