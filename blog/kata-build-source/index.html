<!DOCTYPE html>
<!-- This site was created with Hugo Blox. https://hugoblox.com -->
<!-- Last Published: February 17, 2026 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Hugo Blox Builder 5.9.7" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.26c458e6907dc03073573976b7f4044e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css" integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.d4f5bfbf6342fcc4a6bb8d18586cb58a.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  



























  
  
  






  <meta name="author" content="Charalampos Mainas" />





  

<meta name="description" content="Kata Containers enable containers to be seamlessly
executed in Virtual Machines. Kata Containers are as light and fast as
containers and integrate with the container management layers, while also
delivering the security advantages of VMs. Kata Containers is the result of
merging two existing open source projects: Intel Clear Containers and Hyper
runV." />



<link rel="alternate" hreflang="en-us" href="/blog/kata-build-source/" />
<link rel="canonical" href="/blog/kata-build-source/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu_ea0c30c6d45d84f4.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu_86daab30bf3ca8be.png" />

<meta name="theme-color" content="#1565c0" />










  
  






<meta property="twitter:card" content="summary" />

  <meta property="twitter:site" content="@GetResearchDev" />
  <meta property="twitter:creator" content="@GetResearchDev" />
<meta property="twitter:image" content="/media/logo_hu_f553cb9eef83bc41.png" />



  

<meta property="og:type" content="website" />
<meta property="og:site_name" content="Nubificus" />
<meta property="og:url" content="/blog/kata-build-source/" />
<meta property="og:title" content="Build Kata Containers from source on x86 and arm64 | Nubificus" />
<meta property="og:description" content="Kata Containers enable containers to be seamlessly
executed in Virtual Machines. Kata Containers are as light and fast as
containers and integrate with the container management layers, while also
delivering the security advantages of VMs. Kata Containers is the result of
merging two existing open source projects: Intel Clear Containers and Hyper
runV." /><meta property="og:image" content="/media/logo_hu_f553cb9eef83bc41.png" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2022-03-24T10:18:06&#43;00:00"
    />
  
  
    <meta property="article:modified_time" content="2022-03-24T10:18:06&#43;00:00">
  







  




  
  
  

  
  

  
  
  
  
  
    <script src="https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.js" integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.css" integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin="anonymous">
  
  <script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#1565c0",
          "text": "rgb(255, 255, 255)"
        },
        "button": {
          "background": "rgb(255, 255, 255)",
          "text": "#1565c0"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://www.cookiesandyou.com"
      }
    })});
  </script>



  
  <title>Build Kata Containers from source on x86 and arm64 | Nubificus</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="0268b8596661b1e23013e2b21530126d" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.9e4214442a7711d35691acd58f6f6361.js"></script>

  




  <div class="page-header header--fixed">
  
  
  
  
  


<style>
.navbar-logo {
    height: 50px;
    display: flex;
    align-items: center;
}

.navbar-logo img {
    max-height: 45px;
    width: auto;
    display: block;
}

.navbar-logo .logo-dark {
    display: none;
}

body.colorscheme-dark .navbar-logo .logo-light,
body.dark .navbar-logo .logo-light {
    display: none;
}

body.colorscheme-dark .navbar-logo .logo-dark,
body.dark .navbar-logo .logo-dark {
    display: block;
}

.navbar-logo.logo-nubis,
.navbar-logo.logo-nubificus {
    display: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var host = window.location.hostname;
    var isNubis = (host === 'nubis-pc.eu' || host === 'www.nubis-pc.eu');
    var cls = isNubis ? 'logo-nubis' : 'logo-nubificus';
    document.querySelectorAll('.navbar-logo.' + cls).forEach(function(el) {
        el.style.display = 'flex';
    });
    document.querySelectorAll('[data-brand]').forEach(function(el) {
        var role = el.getAttribute('data-brand');
        if (isNubis) {
            el.textContent = (role === 'primary') ? 'Nubis' : 'Nubificus';
        } else {
            el.textContent = (role === 'primary') ? 'Nubificus' : 'Nubis';
        }
    });
});
</script>










  


<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      
      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">
          <div class="navbar-logo logo-nubificus">
            <img class="logo-light" src="/media/logo-nubificus_hu_5bae3e7b5bc92c43.png" alt="Nubificus">
            <img class="logo-dark" src="/media/logo-nubificus-dark_hu_1887b26263e462ca.png" alt="Nubificus">
          </div>
          <div class="navbar-logo logo-nubis">
            <img class="logo-light" src="/media/logo-nubis.png" alt="Nubis PC">
            <img class="logo-dark" src="/media/logo-nubis-dark.png" alt="Nubis PC">
          </div>
        </a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">
          <div class="navbar-logo logo-nubificus">
            <img class="logo-light" src="/media/logo-nubificus_hu_5bae3e7b5bc92c43.png" alt="Nubificus">
            <img class="logo-dark" src="/media/logo-nubificus-dark_hu_1887b26263e462ca.png" alt="Nubificus">
          </div>
          <div class="navbar-logo logo-nubis">
            <img class="logo-light" src="/media/logo-nubis.png" alt="Nubis PC">
            <img class="logo-dark" src="/media/logo-nubis-dark.png" alt="Nubis PC">
          </div>
        </a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          

          

          
          
          
          

          
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/"><span>Home</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Research</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/projects/"><span>Projects</span></a>
              
                <a class="dropdown-item" href="/publication"><span>Publications</span></a>
              
            </div>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Solutions</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/solutions/edgelink/"><span>edgeLink</span></a>
              
                <a class="dropdown-item" href="/solutions/urunc/"><span>urunc</span></a>
              
                <a class="dropdown-item" href="/solutions/vaccel/"><span>vAccel</span></a>
              
            </div>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Feed</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/post"><span>News</span></a>
              
                <a class="dropdown-item" href="/event"><span>Events</span></a>
              
            </div>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/blog"><span>Blog</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>About</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/people"><span>People</span></a>
              
                <a class="dropdown-item" href="/contact"><span>Contact</span></a>
              
            </div>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        
        
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>
<script>
document.addEventListener('DOMContentLoaded', function () {
  
  var dropdowns = document.querySelectorAll('.navbar-nav .nav-item.dropdown');
  dropdowns.forEach(function (dd) {
    dd.addEventListener('mouseenter', function () {
      
      dropdowns.forEach(function (other) {
        if (other !== dd) {
          other.classList.remove('show');
          var m = other.querySelector('.dropdown-menu');
          if (m) m.classList.remove('show');
        }
      });
      
      dd.classList.add('show');
      var menu = dd.querySelector('.dropdown-menu');
      if (menu) menu.classList.add('show');
    });
    dd.addEventListener('mouseleave', function () {
      dd.classList.remove('show');
      var menu = dd.querySelector('.dropdown-menu');
      if (menu) menu.classList.remove('show');
    });
  });
});
</script>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  <div class="article-container">
    <a class="blog-back-link" href="javascript:void(0)" onclick="blogGoBack()">
      <i class="fas fa-arrow-left"></i> Back to Blog
    </a>
  </div>

  













  

  
  
  
<div class="article-container pt-3">
  <h1>Build Kata Containers from source on x86 and arm64</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Mar 24, 2022
  </span>
  

  

  

  
  
  
  

  
  

</div>

    





  
</div>



  <div class="article-container">

    <div class="article-style">
      <p><a href="https://katacontainers.io" target="_blank" rel="noopener">Kata Containers</a> enable containers to be seamlessly
executed in Virtual Machines. Kata Containers are as light and fast as
containers and integrate with the container management layers, while also
delivering the security advantages of VMs. Kata Containers is the result of
merging two existing open source projects: Intel Clear Containers and Hyper
runV.</p>
<p>Kata Containers consist of several components. For amd64 machines,
<a href="https://github.com/kata-containers/kata-containers/releases" target="_blank" rel="noopener">binaries</a> are
provided through the
<a href="https://github.com/kata-containers/kata-containers/blob/main/docs/Release-Process.md" target="_blank" rel="noopener">formal</a>
release process. However, for arm64, binary files are not available (<a href="https://github.com/kata-containers/kata-containers/issues/2639" target="_blank" rel="noopener">just
yet</a>).</p>
<p>In this post, we will be going through the steps to build kata containers from
source, both for amd64 and arm64 architectures. In
<a href="https://cloudkernels.github.io/posts/kata-build-configure-qemu/" target="_blank" rel="noopener">follow-up</a>
<a href="https://cloudkernels.github.io/posts/kata-build-configure-fc/" target="_blank" rel="noopener">posts</a>, we go
through the steps to build and configure <a href="https://github.com/qemu/qemu" target="_blank" rel="noopener">QEMU</a>
and <a href="https://github.com/firecracker-microvm/firecracker" target="_blank" rel="noopener">AWS Firecracker</a> as
VMMs for Kata Containers.</p>
<h3 id="install-requirements">Install requirements</h3>
<p>To build Kata Containers we need to install Rust v1.58.1, Go v1.16.10, Docker and some apt/snap packages. The specific versions may change,
so make sure to check the <a href="https://github.com/kata-containers/kata-containers/blob/main/versions.yaml" target="_blank" rel="noopener">versions database</a>.</p>
<h4 id="aptsnap-packages">Apt/Snap Packages:</h4>
<p>We need to install <code>gcc</code>, <code>make</code> and <code>yq v3</code>. <code>containerd</code> and <code>runc</code> are installed by the Docker install script, in the following steps.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt update <span class="o">&amp;&amp;</span> sudo apt upgrade -y
</span></span><span class="line"><span class="cl">sudo apt install gcc make snapd -y
</span></span><span class="line"><span class="cl">sudo snap install yq --channel<span class="o">=</span>v3/stable
</span></span></code></pre></div><h4 id="rust-version-1581">Rust (version 1.58.1):</h4>
<p>We will use <code>rustup</code> to install and set Rust 1.58.1 as our default toolchain:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">down_dir</span><span class="o">=</span><span class="k">$(</span>mktemp -d<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">pushd</span> <span class="nv">$down_dir</span>
</span></span><span class="line"><span class="cl">wget -q https://images.rust-lang.org/rustup/dist/<span class="k">$(</span>uname -p<span class="k">)</span>-unknown-linux-gnu/rustup-init
</span></span><span class="line"><span class="cl">sudo chmod +x rustup-init
</span></span><span class="line"><span class="cl">./rustup-init -q -y --default-toolchain 1.58.1
</span></span><span class="line"><span class="cl"><span class="nb">source</span> <span class="nv">$HOME</span>/.cargo/env
</span></span><span class="line"><span class="cl"><span class="nb">popd</span>
</span></span><span class="line"><span class="cl">rm -rf <span class="nv">$down_dir</span>
</span></span></code></pre></div><h4 id="go-version-11610">Go (version 1.16.10)</h4>
<p>We will download the appropriate Go binaries and add them to the <code>PATH</code> environment variable:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">down_dir</span><span class="o">=</span><span class="k">$(</span>mktemp -d<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">pushd</span> <span class="nv">$down_dir</span>
</span></span><span class="line"><span class="cl">wget -q https://go.dev/dl/go1.16.10.linux-<span class="k">$(</span>dpkg --print-architecture<span class="k">)</span>.tar.gz
</span></span><span class="line"><span class="cl">sudo mkdir -p /usr/local/go1.16
</span></span><span class="line"><span class="cl">sudo tar -C /usr/local/go1.16 -xzf go1.16.10.linux-<span class="k">$(</span>dpkg --print-architecture<span class="k">)</span>.tar.gz
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;export PATH=$PATH:/usr/local/go1.16/go/bin&#39;</span> &gt;&gt; <span class="nv">$HOME</span>/.profile
</span></span><span class="line"><span class="cl"><span class="nb">source</span> <span class="nv">$HOME</span>/.profile
</span></span><span class="line"><span class="cl"><span class="nb">popd</span>
</span></span><span class="line"><span class="cl">rm -rf <span class="nv">$down_dir</span>
</span></span></code></pre></div><h4 id="docker">Docker</h4>
<p>We will install Docker using the provided convenience script:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt-get remove docker docker-engine docker.io containerd runc -y &gt; /dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">sudo rm -rf /var/lib/docker/
</span></span><span class="line"><span class="cl"><span class="nv">down_dir</span><span class="o">=</span><span class="k">$(</span>mktemp -d<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">pushd</span> <span class="nv">$down_dir</span>
</span></span><span class="line"><span class="cl">curl -fsSL https://get.docker.com -o get-docker.sh
</span></span><span class="line"><span class="cl">sudo sh get-docker.sh
</span></span><span class="line"><span class="cl"><span class="c1"># Optionally add user to docker group to run docker without sudo</span>
</span></span><span class="line"><span class="cl"><span class="c1"># sudo usermod -aG docker $USER</span>
</span></span><span class="line"><span class="cl"><span class="nb">popd</span>
</span></span><span class="line"><span class="cl">rm -rf <span class="nv">$down_dir</span>
</span></span></code></pre></div><h3 id="build-kata-components">Build Kata components</h3>
<h4 id="build-kata-runtime">Build kata-runtime</h4>
<p>First, we need to set the correct Go environment variables:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="k">$(</span>go env GOPATH<span class="k">)</span>/bin <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="nb">export</span> <span class="nv">GOPATH</span><span class="o">=</span><span class="k">$(</span>go env GOPATH<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="nb">export</span> <span class="nv">GO111MODULE</span><span class="o">=</span>off
</span></span></code></pre></div><p>We will use <code>go get</code> to download kata-containers source code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get -d -u github.com/kata-containers/kata-containers
</span></span></code></pre></div><p>We are now ready to build the <code>kata-runtime</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">pushd</span> <span class="nv">$GOPATH</span>/src/github.com/kata-containers/kata-containers/src/runtime
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">GO111MODULE</span><span class="o">=</span>on
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PREFIX</span><span class="o">=</span>/opt/kata
</span></span><span class="line"><span class="cl">make
</span></span><span class="line"><span class="cl"><span class="nb">popd</span>
</span></span></code></pre></div><p>To install the binaries to a specific path (say <code>/opt/kata</code>) we need to specify
the <code>PREFIX</code> environment variable prior to installing:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">pushd</span> <span class="nv">$GOPATH</span>/src/github.com/kata-containers/kata-containers/src/runtime
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PREFIX</span><span class="o">=</span>/opt/kata
</span></span><span class="line"><span class="cl">sudo -E <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span> -E <span class="nv">PREFIX</span><span class="o">=</span><span class="nv">$PREFIX</span> make install
</span></span><span class="line"><span class="cl"><span class="nb">popd</span>
</span></span></code></pre></div><p>Kata binaries are now installed in <code>/opt/kata/bin</code> and configs are installed in
<code>/opt/kata/share/defaults/kata-containers/</code>.</p>
<p>It is recommended you add a symbolic link to /opt/kata/bin/kata-runtime and
/opt/kata/bin/containerd-shim-kata-v2 in order for containerd to reach these
binaries from the default system <code>PATH</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo ln -s /opt/kata/bin/kata-runtime /usr/local/bin
</span></span><span class="line"><span class="cl">sudo ln -s /opt/kata/bin/containerd-shim-kata-v2 /usr/local/bin
</span></span></code></pre></div><h4 id="create-a-rootfs--initrd-image">Create a rootfs &amp; initrd image</h4>
<p>We can use either a rootfs or initrd image to launch Kata Containers with Qemu.
However, AWS Firecracker does not work with initrd images, so we will be using a
rootfs image for Kata with Firecracker. If you do not want to use QEMU or QEMU
with initrd, you can skip building the initrd image.</p>
<p>Create the rootfs base image:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">ROOTFS_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">GOPATH</span><span class="si">}</span>/src/github.com/kata-containers/kata-containers/tools/osbuilder/rootfs-builder/rootfs
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$GOPATH</span>/src/github.com/kata-containers/kata-containers/tools/osbuilder/rootfs-builder
</span></span><span class="line"><span class="cl"><span class="c1"># you may change the distro (in this case we used ubuntu). to get supported distros list, run ./rootfs.sh -l</span>
</span></span><span class="line"><span class="cl">script -fec <span class="s1">&#39;sudo -E GOPATH=$GOPATH AGENT_INIT=yes USE_DOCKER=true ./rootfs.sh ubuntu&#39;</span>
</span></span></code></pre></div><p><strong>Note for arm64</strong>:</p>
<p>We noticed that in some instances the kata-agent compilation failed.
A possible workaround was to remove the USE_DOCKER variable. This requires <code>qemu-img</code> command to be available on your system.
You can install it with <code>sudo apt install -y qemu-utils</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">ROOTFS_DIR</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">GOPATH</span><span class="si">}</span><span class="s2">/src/github.com/kata-containers/kata-containers/tools/osbuilder/rootfs-builder/rootfs&#34;</span>
</span></span><span class="line"><span class="cl">sudo rm -rf <span class="si">${</span><span class="nv">ROOTFS_DIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$GOPATH</span>/src/github.com/kata-containers/kata-containers/tools/osbuilder/rootfs-builder
</span></span><span class="line"><span class="cl">script -fec <span class="s1">&#39;sudo -E GOPATH=$GOPATH AGENT_INIT=yes ./rootfs.sh ubuntu&#39;</span>
</span></span></code></pre></div><p>Build a kata rootfs image:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$GOPATH</span>/src/github.com/kata-containers/kata-containers/tools/osbuilder/image-builder <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  script -fec <span class="s1">&#39;sudo -E USE_DOCKER=true -E AGENT_INIT=yes ./image_builder.sh ${ROOTFS_DIR}&#39;</span>
</span></span></code></pre></div><p>Install the kata rootfs image:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PREFIX</span><span class="o">=</span>/opt/kata
</span></span><span class="line"><span class="cl"><span class="nv">commit</span><span class="o">=</span><span class="k">$(</span>git log --format<span class="o">=</span>%h -1 HEAD<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="nv">date</span><span class="o">=</span><span class="k">$(</span>date +%Y-%m-%d-%T.%N%z<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="nv">image</span><span class="o">=</span><span class="s2">&#34;kata-containers-</span><span class="si">${</span><span class="nv">date</span><span class="si">}</span><span class="s2">-</span><span class="si">${</span><span class="nv">commit</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  sudo install -o root -g root -m <span class="m">0640</span> -D kata-containers.img <span class="s2">&#34;</span><span class="nv">$PREFIX</span><span class="s2">/share/kata-containers/</span><span class="si">${</span><span class="nv">image</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="o">(</span><span class="nb">cd</span> <span class="nv">$PREFIX</span>/share/kata-containers <span class="o">&amp;&amp;</span> sudo ln -sf <span class="s2">&#34;</span><span class="nv">$image</span><span class="s2">&#34;</span> kata-containers.img<span class="o">)</span>
</span></span></code></pre></div><p>(OPTIONAL) Next we will build an initrd image:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$GOPATH</span>/src/github.com/kata-containers/kata-containers/tools/osbuilder/initrd-builder
</span></span><span class="line"><span class="cl">script -fec <span class="s1">&#39;sudo -E AGENT_INIT=yes USE_DOCKER=true ./initrd_builder.sh ${ROOTFS_DIR}&#39;</span>
</span></span></code></pre></div><p>(OPTIONAL) Once the image is built, we install it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PREFIX</span><span class="o">=</span>/opt/kata
</span></span><span class="line"><span class="cl"><span class="nv">commit</span><span class="o">=</span><span class="k">$(</span>git log --format<span class="o">=</span>%h -1 HEAD<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="nv">date</span><span class="o">=</span><span class="k">$(</span>date +%Y-%m-%d-%T.%N%z<span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="nv">image</span><span class="o">=</span><span class="s2">&#34;kata-containers-initrd-</span><span class="si">${</span><span class="nv">date</span><span class="si">}</span><span class="s2">-</span><span class="si">${</span><span class="nv">commit</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  sudo install -o root -g root -m <span class="m">0640</span> -D kata-containers-initrd.img <span class="s2">&#34;</span><span class="nv">$PREFIX</span><span class="s2">/share/kata-containers/</span><span class="si">${</span><span class="nv">image</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="o">(</span><span class="nb">cd</span> <span class="nv">$PREFIX</span>/share/kata-containers <span class="o">&amp;&amp;</span> sudo ln -sf <span class="s2">&#34;</span><span class="nv">$image</span><span class="s2">&#34;</span> kata-containers-initrd.img<span class="o">)</span>
</span></span></code></pre></div><h4 id="build-kata-containers-kernel">Build Kata Containers kernel</h4>
<p>First, we need some additional packages to build the kernel:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt install -y libelf-dev bison flex
</span></span></code></pre></div><p>Setup the kernel source code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$GOPATH</span>/src/github.com/kata-containers/kata-containers/tools/packaging/kernel
</span></span><span class="line"><span class="cl">./build-kernel.sh -d setup
</span></span></code></pre></div><p>Build the kernel:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./build-kernel.sh -d build
</span></span></code></pre></div><p>Install the kernel in the default path for Kata:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PREFIX</span><span class="o">=</span>/opt/kata
</span></span><span class="line"><span class="cl">sudo -E <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span> -E <span class="nv">PREFIX</span><span class="o">=</span><span class="nv">$PREFIX</span> ./build-kernel.sh -d install
</span></span></code></pre></div><p><strong>Note</strong>:</p>
<p>We noticed that in some instances the installation or build process failed with the following error: <code>ERROR: path to kernel does not exist, use build-kernel.sh setup</code>. We mitigated this problem by specifying the version:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./build-kernel.sh -d -v 5.15.26 build
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PREFIX</span><span class="o">=</span>/opt/kata
</span></span><span class="line"><span class="cl">sudo -E <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span> -E <span class="nv">PREFIX</span><span class="o">=</span><span class="nv">$PREFIX</span> ./build-kernel.sh -d -v 5.15.26 install
</span></span></code></pre></div><h3 id="next-steps">Next steps</h3>
<p>At this point we have successfully built all the Kata components. All the binaries we built are stored under the <code>/opt/kata/bin</code> dir:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls -l /opt/kata/bin/
</span></span><span class="line"><span class="cl">total <span class="m">142296</span>
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">50919312</span> Mar  <span class="m">25</span> 15:32 containerd-shim-kata-v2
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root    <span class="m">16691</span> Mar  <span class="m">25</span> 15:32 kata-collect-data.sh
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">42093616</span> Mar  <span class="m">25</span> 15:32 kata-monitor
</span></span><span class="line"><span class="cl">-rwxr-xr-x <span class="m">1</span> root root <span class="m">52673784</span> Mar  <span class="m">25</span> 15:32 kata-runtime
</span></span></code></pre></div><p>The rootfs image, the initrd image and the kernel are stored under the <code>/opt/kata/share/defaults/kata-containers</code> dir:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls -l /opt/kata/share/kata-containers/
</span></span><span class="line"><span class="cl">total <span class="m">221972</span>
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root     <span class="m">72480</span> Μαρ  <span class="m">25</span> 15:51 config-5.15.26
</span></span><span class="line"><span class="cl">-rw-r----- <span class="m">1</span> root root <span class="m">134217728</span> Μαρ  <span class="m">25</span> 15:41 kata-containers-2022-03-25-15:41:55.534872004+0200-486322a0
</span></span><span class="line"><span class="cl">lrwxrwxrwx <span class="m">1</span> root root        <span class="m">59</span> Μαρ  <span class="m">25</span> 15:41 kata-containers.img -&gt; kata-containers-2022-03-25-15:41:55.534872004+0200-486322a0
</span></span><span class="line"><span class="cl">-rw-r----- <span class="m">1</span> root root  <span class="m">27627256</span> Μαρ  <span class="m">24</span> 14:43 kata-containers-initrd-2022-03-24-14:43:59.501993241+0200-853dd98b
</span></span><span class="line"><span class="cl">-rw-r----- <span class="m">1</span> root root  <span class="m">27626874</span> Μαρ  <span class="m">25</span> 15:42 kata-containers-initrd-2022-03-25-15:42:28.034074480+0200-486322a0
</span></span><span class="line"><span class="cl">lrwxrwxrwx <span class="m">1</span> root root        <span class="m">66</span> Μαρ  <span class="m">25</span> 15:42 kata-containers-initrd.img -&gt; kata-containers-initrd-2022-03-25-15:42:28.034074480+0200-486322a0
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root  <span class="m">38736168</span> Μαρ  <span class="m">25</span> 15:51 vmlinux-5.15.26-90
</span></span><span class="line"><span class="cl">lrwxrwxrwx <span class="m">1</span> root root        <span class="m">18</span> Μαρ  <span class="m">25</span> 15:51 vmlinux.container -&gt; vmlinux-5.15.26-90
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root   <span class="m">5795664</span> Μαρ  <span class="m">25</span> 15:51 vmlinuz-5.15.26-90
</span></span><span class="line"><span class="cl">lrwxrwxrwx <span class="m">1</span> root root        <span class="m">18</span> Μαρ  <span class="m">25</span> 15:51 vmlinuz.container -&gt; vmlinuz-5.15.26-90
</span></span></code></pre></div><p>The configuration files are stored under the <code>/opt/kata/share/defaults/kata-containers</code> dir:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ls -l /opt/kata/share/defaults/kata-containers
</span></span><span class="line"><span class="cl">total <span class="m">72</span>
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root  <span class="m">9717</span> Μαρ  <span class="m">25</span> 15:32 configuration-acrn.toml
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root <span class="m">13535</span> Μαρ  <span class="m">25</span> 15:32 configuration-clh.toml
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root <span class="m">15364</span> Μαρ  <span class="m">25</span> 15:32 configuration-fc.toml
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root <span class="m">25701</span> Μαρ  <span class="m">25</span> 15:32 configuration-qemu.toml
</span></span><span class="line"><span class="cl">lrwxrwxrwx <span class="m">1</span> root root    <span class="m">23</span> Μαρ  <span class="m">25</span> 15:32 configuration.toml -&gt; configuration-qemu.toml
</span></span></code></pre></div><p>Now, we need to install a hypervisor (eg QEMU or Firecracker) and configure
Kata Containers and containerd accordingly.  In our upcoming posts we will go
through the process of building and configuring both
<a href="/posts/kata-build-configure-qemu/">QEMU</a> and
<a href="/posts/kata-build-configure-fc/">AWS
Firecracker</a> for
x86 and arm64 hosts. Happy hacking!</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/kata-containers/">Kata-Containers</a>
  
  <a class="badge badge-light" href="/tag/docker/">Docker</a>
  
  <a class="badge badge-light" href="/tag/qemu/">QEMU</a>
  
  <a class="badge badge-light" href="/tag/aws-firecracker/">AWS Firecracker</a>
  
  <a class="badge badge-light" href="/tag/containers/">Containers</a>
  
  <a class="badge badge-light" href="/tag/arm64/">Arm64</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=%2Fblog%2Fkata-build-source%2F&amp;text=Build&#43;Kata&#43;Containers&#43;from&#43;source&#43;on&#43;x86&#43;and&#43;arm64" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=%2Fblog%2Fkata-build-source%2F&amp;t=Build&#43;Kata&#43;Containers&#43;from&#43;source&#43;on&#43;x86&#43;and&#43;arm64" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=Build%20Kata%20Containers%20from%20source%20on%20x86%20and%20arm64&amp;body=%2Fblog%2Fkata-build-source%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=%2Fblog%2Fkata-build-source%2F&amp;title=Build&#43;Kata&#43;Containers&#43;from&#43;source&#43;on&#43;x86&#43;and&#43;arm64" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="whatsapp://send?text=Build&#43;Kata&#43;Containers&#43;from&#43;source&#43;on&#43;x86&#43;and&#43;arm64%20%2Fblog%2Fkata-build-source%2F" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=%2Fblog%2Fkata-build-source%2F&amp;title=Build&#43;Kata&#43;Containers&#43;from&#43;source&#43;on&#43;x86&#43;and&#43;arm64" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>
























  </div>
</article>

<script>
function blogGoBack() {
  if (document.referrer && document.referrer.indexOf('/blog') !== -1) {
    history.back();
  } else {
    window.location.href = '\/blog\/';
  }
}
</script>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    © 2026 Nubificus LTD. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank">CC BY NC ND 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-nd fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Hugo Blox Builder</a> — the free, <a href="https://github.com/HugoBlox/hugo-blox-builder" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.5faf09821dbe513ca103e87bafd52766.js"></script>




  

  
  

  






  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>



































<script id="page-data" type="application/json">{"use_headroom":true}</script>


  <script src="/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js" type="module"></script>










<script src="/en/js/wowchemy.min.e166a4f802c5f09237cc72919197d83b.js"></script>



  <script src="/js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js" type="module"></script>




  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.9c0e895144aef5a693008b5c5d450147.js" type="module"></script>


















</body>
</html>
