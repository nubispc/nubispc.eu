<!doctype html><!-- This site was created with Hugo Blox. https://hugoblox.com --><!-- Last Published: February 20, 2026 --><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo Blox Builder 5.9.7"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=/css/vendor-bundle.min.26c458e6907dc03073573976b7f4044e.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=/css/wowchemy.1aac88f67649a5938f00c9b82441a209.css><link rel=stylesheet href=/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><script async src="https://www.googletagmanager.com/gtag/js?id=G-KSC25ZE341"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}function trackOutboundLink(e,t){gtag("event","click",{event_category:"outbound",event_label:e,transport_type:"beacon",event_callback:function(){t!=="_blank"&&(document.location=e)}}),console.debug("Outbound link clicked: "+e)}function onClickCallback(e){if(e.target.tagName!=="A"||e.target.host===window.location.host)return;trackOutboundLink(e.target,e.target.getAttribute("target"))}gtag("js",new Date),gtag("config","G-KSC25ZE341",{anonymize_ip:!0}),gtag("set",{cookie_flags:"SameSite=None;Secure"}),document.addEventListener("click",onClickCallback,!1)</script><meta name=author content="Charalampos Mainas"><meta name=description content="Testing is an important part of software development, yet is often neglected in many projects. We felt our code base for vAccel had reached a stage where the foundations for a proper testing framework would be a good decision."><link rel=alternate hreflang=en-us href=/blog/testing_post/><link rel=canonical href=/blog/testing_post/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu_997e0522978c46c6.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu_409bdbda4e241619.png><meta name=theme-color content="#1565c0"><meta property="twitter:card" content="summary"><meta property="twitter:site" content="@GetResearchDev"><meta property="twitter:creator" content="@GetResearchDev"><meta property="twitter:image" content="/media/logo_hu_866fdf07312224c.png"><meta property="og:type" content="website"><meta property="og:site_name" content="Nubificus"><meta property="og:url" content="/blog/testing_post/"><meta property="og:title" content="Updating our testing framework using Catch2 | Nubificus"><meta property="og:description" content="Testing is an important part of software development, yet is often neglected in many projects. We felt our code base for vAccel had reached a stage where the foundations for a proper testing framework would be a good decision."><meta property="og:image" content="/media/logo_hu_866fdf07312224c.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2024-01-10T14:41:40+02:00"><meta property="article:modified_time" content="2024-01-10T14:41:40+02:00"><script src=https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.js integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.css integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin=anonymous><script>window.addEventListener("load",function(){window.cookieconsent.initialise({palette:{popup:{background:"#1565c0",text:"rgb(255, 255, 255)"},button:{background:"rgb(255, 255, 255)",text:"#1565c0"}},theme:"classic",content:{message:"This website uses cookies to ensure you get the best experience on our website.",dismiss:"Got it!",link:"Learn more",href:"https://www.cookiesandyou.com"}})})</script><title>Updating our testing framework using Catch2 | Nubificus</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=ba0874d7ed0f91cb506672d6c1f9a1f8><script src=/js/wowchemy-init.min.9e4214442a7711d35691acd58f6f6361.js></script><div class="page-header header--fixed"><style>.navbar-logo img{max-height:45px;width:auto;display:block}.navbar-logo .logo-dark{display:none}body.colorscheme-dark .navbar-logo .logo-light,body.dark .navbar-logo .logo-light{display:none}body.colorscheme-dark .navbar-logo .logo-dark,body.dark .navbar-logo .logo-dark{display:block}.navbar-logo.logo-nubis,.navbar-logo.logo-nubificus{display:none}</style><script>document.addEventListener("DOMContentLoaded",function(){var e=window.location.hostname,t=e==="nubis-pc.eu"||e==="www.nubis-pc.eu",n=t?"logo-nubis":"logo-nubificus";document.querySelectorAll(".navbar-logo."+n).forEach(function(e){e.style.display="flex"}),document.querySelectorAll("[data-brand]").forEach(function(e){var n=e.getAttribute("data-brand");t?e.textContent=n==="primary"?"Nubis":"Nubificus":e.textContent=n==="primary"?"Nubificus":"Nubis"})})</script><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/><div class="navbar-logo logo-nubificus"><img class=logo-light src=/media/logo-nubificus_hu_7be4fa6b19286a64.png alt=Nubificus>
<img class=logo-dark src=/media/logo-nubificus-dark_hu_bd80a6d6121ee2ff.png alt=Nubificus></div><div class="navbar-logo logo-nubis"><img class=logo-light src=/media/logo-nubis.png alt="Nubis PC">
<img class=logo-dark src=/media/logo-nubis-dark.png alt="Nubis PC"></div></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/><div class="navbar-logo logo-nubificus"><img class=logo-light src=/media/logo-nubificus_hu_7be4fa6b19286a64.png alt=Nubificus>
<img class=logo-dark src=/media/logo-nubificus-dark_hu_bd80a6d6121ee2ff.png alt=Nubificus></div><div class="navbar-logo logo-nubis"><img class=logo-light src=/media/logo-nubis.png alt="Nubis PC">
<img class=logo-dark src=/media/logo-nubis-dark.png alt="Nubis PC"></div></a></div><div class="navbar-collapse main-menu-item collapse justify-content-end" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/><span>Home</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Research</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/projects/><span>Projects</span></a>
<a class=dropdown-item href=/publication><span>Publications</span></a></div></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Solutions</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/solutions/edgelink/><span>edgeLink</span></a>
<a class=dropdown-item href=/solutions/urunc/><span>urunc</span></a>
<a class=dropdown-item href=/solutions/vaccel/><span>vAccel</span></a></div></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Feed</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/post><span>News</span></a>
<a class=dropdown-item href=/event><span>Events</span></a></div></li><li class=nav-item><a class="nav-link active" href=/blog><span>Blog</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>About</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/people><span>People</span></a>
<a class=dropdown-item href=/contact><span>Contact</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span>
</a><a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span>
</a><a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header><script>document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".navbar-nav .nav-item.dropdown");e.forEach(function(t){t.addEventListener("mouseenter",function(){e.forEach(function(e){if(e!==t){e.classList.remove("show");var n=e.querySelector(".dropdown-menu");n&&n.classList.remove("show")}}),t.classList.add("show");var n=t.querySelector(".dropdown-menu");n&&n.classList.add("show")}),t.addEventListener("mouseleave",function(){t.classList.remove("show");var e=t.querySelector(".dropdown-menu");e&&e.classList.remove("show")})})})</script></div><div class=page-body><article class=article><div class=article-container><a class=blog-back-link href=javascript:void(0) onclick=blogGoBack()><i class="fas fa-arrow-left"></i> Back to Blog</a></div><div class="article-container pt-3"><h1>Updating our testing framework using Catch2</h1><div class=article-metadata><span class=article-date>Jan 10, 2024</span></div></div><div class=article-container><div class=article-style><p>Testing is an important part of software development, yet is often neglected in many projects. We felt our code base for vAccel had reached a stage where the foundations for a proper testing framework would be a good decision.</p><p>Introducing a testing framework early on would allow us to identify and fix bugs and errors in our code faster. It would also allow us to implement tests easily and faster. In this post, we will look at the initial setup we used for testing and the testing frameworks and methods we considered before finally ending up with our framework of choice, Catch2.</p><p>Initially, we used Google Test, which is a testing framework written in C++ and is a very popular testing framework. In fact, it was the most popular according to this survey by <a href=https://www.jetbrains.com/lp/devecosystem-2021/cpp/ target=_blank rel=noopener>JetBrains</a>.</p><p>Surprisingly (or unsurprisingly), a large majority in this survey don&rsquo;t test at all - fortunately, we will not follow this approach. Google Test is a really good testing framework and is full of many features which can be useful in complex projects. However, for vAccel, it is a bit overkill and quite hard to write tests for as we will see later.</p><p>This forms part of the desire of wanting to switch to a different testing framework - if the framework allows tests to be written in a faster and efficient manner, it will encourage us to write tests in the first place - which is a good thing!</p><h4 id=initial-google-test-setup>Initial Google Test setup</h4><p>Let&rsquo;s dive into the very rudimentary test we had, written using Google Test.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=k>class</span> <span class=nc>PluginTests</span> <span class=o>:</span> <span class=k>public</span> <span class=o>::</span><span class=n>testing</span><span class=o>::</span><span class=n>Test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>int</span> <span class=nf>fini</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>VACCEL_OK</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>int</span> <span class=nf>init</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>VACCEL_OK</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* initialize structures with zeros */</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>vaccel_plugin</span> <span class=n>plugin</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>vaccel_plugin_info</span> <span class=n>pinfo</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>SetUp</span><span class=p>()</span> <span class=k>override</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>plugin</span><span class=p>.</span><span class=n>info</span> <span class=o>=</span> <span class=o>&amp;</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>pinfo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>plugin</span><span class=p>.</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>=</span> <span class=n>pname</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>list_init_entry</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>.</span><span class=n>entry</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>list_init_entry</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>.</span><span class=n>ops</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>plugin</span><span class=p>.</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>init</span> <span class=o>=</span> <span class=n>init</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>plugin</span><span class=p>.</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>fini</span> <span class=o>=</span> <span class=n>fini</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>plugins_bootstrap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>TearDown</span><span class=p>()</span> <span class=k>override</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>plugins_shutdown</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>Here we provide definitions for <code>SetUp()</code> and <code>TearDown()</code> in the fixture <code>PluginTests</code>. We can then use this fixture in the following way:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>TEST_F</span><span class=p>(</span><span class=n>PluginTests</span><span class=p>,</span> <span class=n>plugin_init_null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ASSERT_EQ</span><span class=p>(</span><span class=n>register_plugin</span><span class=p>(</span><span class=nb>NULL</span><span class=p>),</span> <span class=n>VACCEL_EINVAL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In this basic test, <code>SetUp()</code> is ran before asserting our function <code>register_plugin(NULL)</code> is equal to <code>VACCEL_EINVAL</code>. To wrap up our test, <code>TearDown()</code> is executed last and that&rsquo;s our basic test done!</p><p>This seems rather straightforward, and it is! However, this is only one test and if we want to use other fixtures in our test files, it gets convoluted very quickly and the readability of the tests goes downhill very fast. Of course, this is fine and we could have carried on using Google Test as our framework and be done with it but since we are at an early stage it is relatively easy to change our approach and see if anything else fits better for vAccel. A key thing with GTest was that it is possible to include in the CMake process which is useful for our build process.</p><h4 id=unity>Unity?</h4><p>One of the frameworks we looked at was Unity - which is a framework written in C. Unlike Google Test, to include Unity in our testing directory, we just <code>#include "unity.h"</code> in our testing file and that&rsquo;s it!</p><p>Tests in unity are straightforward:</p><p>Again, we have a <code>setUp()</code> and <code>tearDown()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>void</span> <span class=nf>setUp</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>plugin</span><span class=p>.</span><span class=n>info</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>pinfo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>pinfo</span><span class=p>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>pname</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>list_init_entry</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>.</span><span class=n>entry</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>list_init_entry</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>.</span><span class=n>ops</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>pinfo</span><span class=p>.</span><span class=n>init</span> <span class=o>=</span> <span class=n>init</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>pinfo</span><span class=p>.</span><span class=n>fini</span> <span class=o>=</span> <span class=n>fini</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>plugins_bootstrap</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>tearDown</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>plugins_shutdown</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Our basic test would be as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_plugin_null</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>TEST_ASSERT_EQUAL</span><span class=p>(</span><span class=nf>register_plugin</span><span class=p>(</span><span class=nb>NULL</span><span class=p>),</span> <span class=n>VACCEL_EINVAL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Like GTest, we have a <code>setUp</code> and <code>TearDown</code> function and for our assertion macro we use <code>TEST_ASSERT_EQUAL</code>. From a readability standpoint, this is easier to read than GTest. The main issue we found with Unity is that having different fixtures in the same file is difficult and in many cases, it&rsquo;s just easier to create a new file instead. This is rather tedious and having several files for one source file we are testing is not ideal so we now instead cast our eyes at Catch2.</p><h4 id=finally-catch2>Finally, Catch2</h4><p>Catch2, just like Unity, uses a single header file. We just drag and drop the header in our testing directory - which is very convenient! Let&rsquo;s start again with our basic test written in Catch2 this time.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>TEST_CASE</span><span class=p>(</span><span class=s>&#34;plugin_register&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>ret</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>vaccel_plugin</span> <span class=n>plugin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>vaccel_plugin_info</span> <span class=n>pinfo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>plugin</span><span class=p>.</span><span class=n>info</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>pinfo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>plugin</span><span class=p>.</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>=</span> <span class=n>pname</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list_init_entry</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>.</span><span class=n>entry</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>list_init_entry</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>.</span><span class=n>ops</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>plugin</span><span class=p>.</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>init</span> <span class=o>=</span> <span class=n>init</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>plugin</span><span class=p>.</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>fini</span> <span class=o>=</span> <span class=n>fini</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ret</span> <span class=o>=</span> <span class=n>plugins_bootstrap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>REQUIRE</span><span class=p>(</span><span class=n>ret</span> <span class=o>==</span> <span class=n>VACCEL_OK</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ret</span> <span class=o>=</span> <span class=n>register_plugin</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>REQUIRE</span><span class=p>(</span><span class=n>ret</span> <span class=o>==</span> <span class=n>VACCEL_OK</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ret</span> <span class=o>=</span> <span class=n>plugins_shutdown</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>REQUIRE</span><span class=p>(</span><span class=n>ret</span> <span class=o>==</span> <span class=n>VACCEL_OK</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>As before, this is quite readable but Catch2 does not encourage the use of traditional fixtures, unlike the other two frameworks we have looked at. Catch2 uses an alternative syntax (as well as traditional fixtures) using BDD-style test cases (Behaviour Driven Development). With the use of <code>SECTIONS</code>, we can write our tests more expressively.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>TEST_CASE</span><span class=p>(</span><span class=s>&#34;plugin_register&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>vaccel_plugin</span> <span class=n>plugin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>vaccel_plugin_info</span> <span class=n>pinfo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>plugin</span><span class=p>.</span><span class=n>info</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>pinfo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>plugin</span><span class=p>.</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>=</span> <span class=n>pname</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list_init_entry</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>.</span><span class=n>entry</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>list_init_entry</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>.</span><span class=n>ops</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>plugin</span><span class=p>.</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>init</span> <span class=o>=</span> <span class=n>init</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>plugin</span><span class=p>.</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>fini</span> <span class=o>=</span> <span class=n>fini</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>plugins_bootstrap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SECTION</span><span class=p>(</span><span class=s>&#34;normal plugin initialisation&#34;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>REQUIRE</span><span class=p>(</span><span class=n>register_plugin</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>)</span> <span class=o>==</span> <span class=n>VACCEL_OK</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>REQUIRE</span><span class=p>(</span><span class=n>unregister_plugin</span><span class=p>(</span><span class=o>&amp;</span><span class=n>plugin</span><span class=p>)</span> <span class=o>==</span> <span class=n>VACCEL_OK</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SECTION</span><span class=p>(</span><span class=s>&#34;null plugin initialisation&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>REQUIRE</span><span class=p>(</span><span class=n>register_plugin</span><span class=p>(</span><span class=nb>NULL</span><span class=p>)</span> <span class=o>==</span> <span class=n>VACCEL_EINVAL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>plugins_shutdown</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Nice! We have our startup and tear down functions within our <code>TEST_CASE</code> and we can separate different tests from each other as well, without them interfering with each other. These sections can also be nested and for our approach we generally use a test case per function/class and then a section for each function branch or method. The assertions are also expressive as well with <code>REQUIRE</code> and <code>CHECK</code>, which just relies on the natural C++ syntax for conditions which is also nice. The test case names can also be descriptive as well - just a regular string compared to the valid identifier GTest makes you use.
As part of our testing framework, we also include it in our CMake process, simply by using <code>-DENABLE_TESTS=ON</code> when we make and run the tests automatically using <code>make test</code> with CTest. It is seamless compared to GTest integration with CMake, perfect!</p><p>However, a downside we found during initial testing is that there seems to be no way to set breakpoints in tests. A workaround used for now is to set breakpoints in the code which was being tested - this is not a deal-breaker at the moment.</p><h4 id=updating-our-cicd>Updating our CI/CD</h4><p>Whilst we were at it, we also updated our CI workflow using GitHub Actions.</p><p>We first run our tests - make sure they pass for all the architectures we build for. When this passes, we run Valgrind memory leak tests, a few linters, a spellcheck and a check to see if the commit meets the standards it should.</p><p>Here is our testing pipeline:</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=/images/testing/new_test.png#center alt="Alt text" loading=lazy data-zoomable></div></div></figure></p><p>When our PR is merged, this triggers another pipeline which deploys our code and binaries as seen here:</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=/images/testing/new_release.png#center alt="Alt text" loading=lazy data-zoomable></div></div></figure></p><p>In the end, we check the coverage for our tests for our source code to make sure new code is being tested and our old tests still run fine. A final coverage markdown table is created and uploaded to our docs.</p><p>The coverage can also be seen in a detailed html view which provides testing feedback immediately when initially writing tests on a local build.</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=/images/testing/coverage.png#center alt="Alt text" loading=lazy data-zoomable></div></div></figure></p><h4 id=finally>Finally</h4><p>For our testing framework, we switched to Catch2. The reasons are simple. A drag-and-drop single header file, easy to integrate with CMake and readable tests.</p><p>With the initial start on the testing framework, we added several tools to help with the testing of the code as well such as Valgrind, linters, static code analysers etc. In the end, these are all tools we can use to make sure the code that is written is as foolproof as it can be from the get-go. With the use of GitHub actions, it is now an integral part of the CI/CD tools of the code base and can be easily extended in the future as well.</p></div><div class=article-tags><a class="badge badge-light" href=/tag/testing/>Testing</a>
<a class="badge badge-light" href=/tag/ci/>CI</a>
<a class="badge badge-light" href=/tag/github-actions/>GitHub Actions</a></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=%2Fblog%2Ftesting_post%2F&amp;text=Updating+our+testing+framework+using+Catch2" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=%2Fblog%2Ftesting_post%2F&amp;t=Updating+our+testing+framework+using+Catch2" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Updating%20our%20testing%20framework%20using%20Catch2&amp;body=%2Fblog%2Ftesting_post%2F" target=_blank rel=noopener class=share-btn-email aria-label=envelope><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=%2Fblog%2Ftesting_post%2F&amp;title=Updating+our+testing+framework+using+Catch2" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Updating+our+testing+framework+using+Catch2%20%2Fblog%2Ftesting_post%2F" target=_blank rel=noopener class=share-btn-whatsapp aria-label=whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=%2Fblog%2Ftesting_post%2F&amp;title=Updating+our+testing+framework+using+Catch2" target=_blank rel=noopener class=share-btn-weibo aria-label=weibo><i class="fab fa-weibo"></i></a></li></ul></div></div></article><script>function blogGoBack(){document.referrer&&document.referrer.indexOf("/blog")!==-1?history.back():window.location.href="/blog/"}</script></div><div class=page-footer><div class=container><footer class=site-footer><p class="powered-by copyright-license-text">© 2026 Nubificus LTD. This work is licensed under <a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank>CC BY NC ND 4.0</a></p><p class="powered-by footer-license-icons"><a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank aria-label="Creative Commons"><i class="fab fa-creative-commons fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-by fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nc fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nd fa-2x" aria-hidden=true></i></a></p><p class=powered-by>Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target=_blank rel=noopener>Hugo Blox Builder</a> — the free, <a href=https://github.com/HugoBlox/hugo-blox-builder target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><script src=/js/vendor-bundle.min.6782e3f6a4f06ea4766df038c45ecf40.js></script><script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script><script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.b95a7e109243f29d04930ae8cb49a756.js type=module></script><script src=/en/js/wowchemy.min.ed487406ecbb80985462ba7a97b6f2d2.js></script><script src=/js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js type=module></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy
</a><a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=/js/wowchemy-publication.9c0e895144aef5a693008b5c5d450147.js type=module></script></body></html>